# System Architecture

## High-Level Architecture

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  Client Apps    │◄────►    FastAPI      │◄────►    Database    │
│                 │     │    Backend      │     │   (SQLite/     │
│ (Web/Mobile)    │     │                 │     │   PostgreSQL)  │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                              │     ▲
                              │     │
                              ▼     │
                        ┌─────────────────┐
                        │                 │
                        │    WebSocket    │
                        │  Notifications  │
                        │                 │
                        └─────────────────┘

```

## Component Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                      FastAPI Application                     │
│                                                             │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐       │
│  │             │   │             │   │             │       │
│  │    API      │   │   Models    │   │  Schemas    │       │
│  │  Endpoints  │   │  (SQLAlch)  │   │ (Pydantic)  │       │
│  │             │   │             │   │             │       │
│  └─────────────┘   └─────────────┘   └─────────────┘       │
│         │                │                  │               │
│         ▼                ▼                  ▼               │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐       │
│  │             │   │             │   │             │       │
│  │   Services  │   │    CRUD     │   │  Security   │       │
│  │             │   │             │   │             │       │
│  └─────────────┘   └─────────────┘   └─────────────┘       │
│         │                │                  │               │
│         ▼                ▼                  ▼               │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐       │
│  │             │   │             │   │             │       │
│  │    Cache    │   │  Database   │   │    Rate     │       │
│  │             │   │             │   │   Limiter   │       │
│  └─────────────┘   └─────────────┘   └─────────────┘       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## Data Flow

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│          │    │          │    │          │    │          │
│  Client  │───►│   API    │───►│  Service │───►│   CRUD   │
│          │    │ Endpoint │    │   Layer  │    │   Ops    │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
     ▲               │               │               │
     │               ▼               ▼               ▼
     │          ┌──────────┐    ┌──────────┐    ┌──────────┐
     │          │          │    │          │    │          │
     └──────────│  Cache   │    │  Models  │    │ Database │
                │          │    │          │    │          │
                └──────────┘    └──────────┘    └──────────┘
```

## Authentication Flow

```
┌──────────┐                                      ┌──────────┐
│          │                                      │          │
│  Client  │                                      │   API    │
│          │                                      │          │
└──────────┘                                      └──────────┘
     │                                                 │
     │  1. POST /auth/login {username, password}      │
     │ ─────────────────────────────────────────────► │
     │                                                │
     │  2. Validate credentials                       │
     │                                                │
     │  3. Generate JWT tokens                        │
     │                                                │
     │  4. {access_token, refresh_token}             │
     │ ◄───────────────────────────────────────────── │
     │                                                │
     │  5. Requests with Bearer token                 │
     │ ─────────────────────────────────────────────► │
     │                                                │
     │  6. Validate token & authorize                 │
     │                                                │
     │  7. Response                                   │
     │ ◄───────────────────────────────────────────── │
     │                                                │
```

## Event Collaboration Flow

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  User A  │    │   API    │    │WebSocket │    │  User B  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
     │               │               │               │
     │  Update Event │               │               │
     │ ─────────────►│               │               │
     │               │               │               │
     │               │  Notification │               │
     │               │ ─────────────►│ ─────────────►│
     │               │               │               │
     │    Response   │               │               │
     │ ◄─────────────│               │               │
     │               │               │               │
     │               │  Get Event    │               │
     │               │ ◄─────────────────────────────│
     │               │               │               │
     │               │   Response    │               │
     │               │ ─────────────────────────────►│
     │               │               │               │
```

## Database Schema

```
┌──────────────┐       ┌──────────────┐       ┌──────────────┐
│    Users     │       │    Events    │       │   Versions   │
├──────────────┤       ├──────────────┤       ├──────────────┤
│ id           │       │ id           │       │ id           │
│ email        │       │ title        │       │ event_id     │
│ username     │       │ description  │       │ data         │
│ password     │       │ start_time   │       │ created_at   │
│ created_at   │       │ end_time     │       │ created_by   │
└──────────────┘       │ is_recurring │       └──────────────┘
        │              │ created_by   │              ▲
        │              └──────────────┘              │
        │                     ▲                      │
        │                     │                      │
        │              ┌──────────────┐       ┌──────────────┐
        └─────────────►│ Permissions  │       │Notifications │
                      ├──────────────┤       ├──────────────┤
                      │ event_id     │       │ user_id      │
                      │ user_id      │       │ role         │
                      │ role         │       │ event_id     │
                      └──────────────┘       │ type         │
                                            │ is_read      │
                                            └──────────────┘
```

## Caching Strategy

```
┌──────────────────────────────────────────────────────────┐
│                      Cache System                         │
│                                                          │
│  ┌────────────────┐        ┌─────────────────────────┐  │
│  │  Short-term    │        │      Long-term          │  │
│  │   (1 minute)   │        │     (5 minutes)         │  │
│  ├────────────────┤        ├─────────────────────────┤  │
│  │ Event Details  │        │ Event Listings          │  │
│  │ User Profiles  │        │ Permission Maps         │  │
│  └────────────────┘        └─────────────────────────┘  │
│                                                          │
│  ┌────────────────┐        ┌─────────────────────────┐  │
│  │  Per-User      │        │     Global             │  │
│  │    Cache       │        │     Cache              │  │
│  ├────────────────┤        ├─────────────────────────┤  │
│  │ Notifications  │        │ System Settings         │  │
│  │ Preferences    │        │ Static Data            │  │
│  └────────────────┘        └─────────────────────────┘  │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

## Rate Limiting

```
┌──────────────────────────────────────────────────────────┐
│                    Rate Limiting                          │
│                                                          │
│  ┌────────────────┐        ┌─────────────────────────┐  │
│  │     Auth       │        │      Regular            │  │
│  │   Endpoints    │        │     Endpoints           │  │
│  ├────────────────┤        ├─────────────────────────┤  │
│  │  5 req/min    │        │    100 req/min         │  │
│  │  per IP       │        │    per user            │  │
│  └────────────────┘        └─────────────────────────┘  │
│                                                          │
│  ┌────────────────┐        ┌─────────────────────────┐  │
│  │   Cleanup      │        │     Tracking            │  │
│  │   Process      │        │     System              │  │
│  ├────────────────┤        ├─────────────────────────┤  │
│  │ Every minute   │        │ In-memory storage       │  │
│  │ Remove old     │        │ Per-endpoint counters   │  │
│  └────────────────┘        └─────────────────────────┘  │
│                                                          │
└──────────────────────────────────────────────────────────┘
``` 